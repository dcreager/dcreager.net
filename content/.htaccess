# ensure HTTPS
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# HSTS!
Header set Strict-Transport-Security "max-age=31536000" env=HTTPS

# NEL!
Header set Report-To "{\"max_age\": 86400, \"include_subdomains\": true, \"endpoints\": [{\"url\": \"https://dcreager.report-uri.com/a/d/g\"}]}" env=HTTPS
Header set NEL "{\"report_to\": \"default\", \"max_age\": 86400, \"include_subdomains\": true, \"success_fraction\": 1.0, \"failure_fraction\": 1.0}" env=HTTPS
RewriteRule ^upload-nel/error(.*)$ - [L,R=400]
RewriteRule ^upload-nel/(.*)$ - [L,R=204]

# Lets Encrypt support
RewriteRule ^.well-known/(.*)$ - [L]

Redirect 301 /2013/01/07/intro-to-csp/ /2014/01/07/intro-to-csp/

Redirect 301 /2016/07/csp-concurrency-intro/ /csp-concurrency/intro/
Redirect 301 /2016/08/csp-concurrency-prelims/ /csp-concurrency/prelims/
Redirect 301 /2016/09/csp-read-atomic-internal/ /csp-concurrency/read-atomic-internal/

Redirect 301 /2016/11/hst-intro/ /hst/intro/
Redirect 301 /2016/11/refinement-overview/ /hst/refinement-overview/
Redirect 301 /2016/11/semantic-methods/ /hst/semantic-methods/
Redirect 301 /2017/01/lazy-processes/ /hst/lazy-processes/
